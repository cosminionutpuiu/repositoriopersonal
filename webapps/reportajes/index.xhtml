<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" template="/layouts/login.xhtml">

	<ui:define name="body">
		<div id="navegacion">
			<ul id="menu"><li><label>#{msg['general.title']}</label></li></ul>
		</div>	
		<div class="clear"></div>

		<h:form id="collectionsForm">
		<div class="container" id="main-container">
			
			<h2 class="page-header">Archivo fotográfico</h2>
			
			<p:outputPanel id="panelSelectAction">
				
				<p:outputPanel layout="block" styleClass="form-horizontal" rendered="#{!collectionController.showFormulario}">
					
					<div class="control-group col-sm-12 row">
						<label class="control-label">#{msg['collections.select.title']}</label>
					</div>
					<div class="row">
						<div class="col-xs-12 col-sm-10">
							<p:selectOneMenu styleClass="form-control col-xs-8" id="collectionSelect" value="#{collectionController.uuidSelectCollection}" 
								filter="true" filterMatchMode="contains">
					            <f:selectItem itemLabel="" itemValue="" />
					            <f:selectItems value="#{collectionController.collectionsSelect}" />
					        </p:selectOneMenu>
						</div>
						<div class="col-xs-12 col-sm-2">
							<p:commandButton id="editCollectionButton"
								styleClass="btn btn-default"
								value="#{msg['collections.button.edit']}"
								action="#{collectionController.editCollectionBefore}"
								update="panelFormulario, panelBotones, panelSelectAction">
							</p:commandButton>
						</div>
					</div>
				    
				</p:outputPanel>
				
				<div class="clearfix" />
				
				<p:outputPanel layout="block" styleClass="form-horizontal" rendered="#{!collectionController.showFormulario}">
					
						<div class="control-group col-sm-12 row">
							<label class="control-label">#{msg['communities.select.title']}</label>
						</div>
						
						<div class="row">
							<div class="col-xs-12 col-sm-10">
								<p:selectOneMenu styleClass="form-control col-sm-8" id="communitySelect" value="#{collectionController.uuidSelectCommunity}" 
									filter="true" filterMatchMode="contains">
						            <f:selectItem itemLabel="" itemValue="" />
						            <f:selectItems value="#{collectionController.communitiesSelect}" />
						        </p:selectOneMenu>
							</div>
							<div class="col-xs-12 col-sm-2">
								<p:commandButton id="addCollectionButton"
									styleClass="btn btn-default"
									value="#{msg['collections.button.add']}"
									action="#{collectionController.addCollectionBefore}"
									update="panelFormulario, panelBotones, panelSelectAction">
								</p:commandButton>
							</div>
						</div>				

				</p:outputPanel>
			</p:outputPanel>
			
			<div class="clearfix" />
			<p:outputPanel id="panelFormulario" styleClass="form-horizontal">
				
				<p:outputPanel rendered="#{collectionController.showFormulario}" >
				
					<p:panelGrid rendered="#{collectionController.addCollectionNew}">
						<div class="control-group col-sm-12 row">
						    <label class="control-label">#{msg['communities.selected']}</label>
						</div>
						<div class="col-xs-12 row">    
						    <p:inputText styleClass="form-control" value="#{collectionController.nameSelectedCommunity}" disabled="true" />
						</div>
					</p:panelGrid>
					
					<h2 class="page-header">Metadatos de colección</h2>
					<p:panelGrid>
						<div class="clearfix" />
						<div class="control-group col-sm-12 row">
						    <label class="control-label">#{msg['collections.edit.title']} *</label>
						</div>    
						<div class="col-sm-12 row">    
						    <p:inputText styleClass="form-control" value="#{collectionController.titleCollection}">
						    	<f:ajax event="blur" listener="#{collectionController.changeTitleItem()}" render="panelFormulario"></f:ajax>
						    </p:inputText>
						    <p:outputLabel value="#{collectionController.errorTitleCollection}" style="color:red" />
						</div>
						<div class="control-group col-sm-12 row">
						    <label class="control-label">#{msg['collections.edit.description']}</label>
						</div>    
						<div class="col-sm-12 row">     
						    <p:inputTextarea styleClass="form-control" value="#{collectionController.descriptionCollection}">
						    	<f:ajax event="blur" listener="#{collectionController.changeTitleItem()}" render="panelFormulario"></f:ajax>
						    </p:inputTextarea>
						    <p:outputLabel />
						</div>
					</p:panelGrid>
					
					<h2 class="page-header">Metadatos de imágenes</h2>				
					<ui:repeat value="#{collectionController.fieldsFormCollection}" var="field">
					    
					    <div class="control-group col-sm-12 row">
						    <label class="control-label" title="#{field.hint}">
						    	#{field.label}
						    	<p:outputLabel class="control-label" rendered="#{!field.required.equals('')}">*</p:outputLabel>
						    </label>
						</div>    
						    
						<div class="col-sm-12 row">       
							<div class="col-sm-11 row">     	
								<p:inputText styleClass="form-control col-xs-12 col-sm-10"
									value="#{field.value}" 
									rendered="#{field.inputType.equals('onebox')}" />
									
								<p:inputTextarea value="#{field.value}" styleClass="form-control"
									rendered="#{field.inputType.equals('textarea')}"></p:inputTextarea>
									
								<p:selectOneMenu value="#{field.value}" styleClass="form-control" 
									rendered="#{field.inputType.equals('dropdown') and !field.repeatable}">
									<f:selectItem itemLabel="" itemValue="" />
									<f:selectItems value="#{field.optionList}" />
								</p:selectOneMenu>
								
								<p:selectCheckboxMenu value="#{field.listValues}" multiple="true" filter="true"
									styleClass="form-control" 
									filterMatchMode="contains" rendered="#{field.inputType.equals('dropdown') and field.repeatable}" >
						            <f:selectItems value="#{field.optionList}" />
						        </p:selectCheckboxMenu>
								
								<p:panelGrid columns="6" rendered="#{field.inputType.equals('date')}" styleClass="dates-table">
									
									<label class="col-sm-3 control-label">#{msg['collections.date.year']}</label>
									<p:inputText styleClass="form-control"
										value="#{field.valueDateYear}" 
										maxlength="4"/>
										
									<label class="col-sm-3 control-label">#{msg['collections.date.month']}</label>
									 <p:selectOneMenu value="#{field.valueDateMonth}" styleClass="form-control">
									 	<f:selectItem itemLabel="" itemValue="" />
							            <f:selectItem itemLabel="Enero" itemValue="01" />
							            <f:selectItem itemLabel="Febrero" itemValue="02" />
							            <f:selectItem itemLabel="Marzo" itemValue="03" />
							            <f:selectItem itemLabel="Abril" itemValue="04" />
							            <f:selectItem itemLabel="Mayo" itemValue="05" />
							            <f:selectItem itemLabel="Junio" itemValue="06" />
							            <f:selectItem itemLabel="Julio" itemValue="07" />
							            <f:selectItem itemLabel="Agosto" itemValue="08" />
							            <f:selectItem itemLabel="Septiembre" itemValue="09" />
							            <f:selectItem itemLabel="Octubre" itemValue="10" />
							            <f:selectItem itemLabel="Noviembre" itemValue="11" />
							            <f:selectItem itemLabel="Diciembre" itemValue="12" />
							        </p:selectOneMenu>
							        
							        <label class="col-sm-3 control-label">#{msg['collections.date.day']}</label>
									<p:inputText styleClass="form-control" value="#{field.valueDateDay}" maxlength="2"/>
									
								</p:panelGrid>
								
							</div>
							<div class="col-sm-1">     	
								
								<p:commandButton
									styleClass="btn btn-default"
									rendered="#{!field.inputType.equals('dropdown') and field.repeatable}"
									value="#{msg['collections.button.addElement']}"
									action="#{collectionController.addElement(field)}"
									update="collectionsForm:panelFormulario">
								</p:commandButton>
							</div>	
						
						</div>
						<div class="col-sm-12 row">  		
								
								<p:dataTable value="#{field.listValues}" var="value" rendered="#{!field.inputType.equals('dropdown') and field.repeatable}" styleClass="form-input-table">
									<p:column width="90%" headerText="Títulos añadidos">
							        	<h:outputText value="#{value}"/>
							        </p:column>
							        <p:column width="10%">
								        <p:commandButton
											styleClass="btn btn-default glyphicon glyphicon-remove-circle"
											value=""
											action="#{collectionController.removeElement(field, value)}"
											update="collectionsForm:panelFormulario">
										</p:commandButton>
										
							        </p:column>
							    </p:dataTable>
								
								<p:outputLabel value="#{field.errorMessage}" style="color:red"></p:outputLabel>
								
							
							
						</div>
						
					</ui:repeat>
					
				</p:outputPanel>
				
				<!--  Panel que controla los ítems de la colección -->
				<p:outputPanel rendered="#{collectionController.showFormulario}">
					<div class="clear"></div>
					<p:fieldset legend="#{msg['collections.items.list.title']}">
						
						<p:fileUpload fileUploadListener="#{collectionController.handleFileUpload}" mode="advanced" dragDropSupport="false"
	           				update="collectionsForm:panelItems" uploadLabel="#{msg['collections.items.file.upload']}"
	           				multiple="true" cancelLabel="#{msg['collections.items.file.cancel']}" label="#{msg['collections.items.file.choose']}" 
	           				rendered="#{collectionController.addCollectionNew}"/>
	 
		    			<p:outputPanel id="panelItems">
		    				
		    				<p:dataTable value="#{collectionController.listFileItems}" var="item" paginator="true" rows="10" rowsPerPageTemplate="5,10,15" 
		    					rendered="#{collectionController.listFileItems.size()!=0}" sortBy="#{item.signature}" expandableRowGroups="true">
		    					<p:headerRow>
						            <p:column colspan="4">
						                <h:outputText value="#{msg['collections.items.signaturePre']}: #{item.signature}" />
						            </p:column>
						        </p:headerRow>
						        <p:column width="50%" headerText="#{msg['collections.items.name']}">
						        	<h:outputText value="#{item.name}" rendered="#{item.internalId==null}"/>
						        	<p:commandLink value="#{item.name}" ajax="false" rendered="#{item.internalId!=null}" actionListener="#{collectionController.preDownload(item)}">
					                	<p:fileDownload value="#{item.fileDownload}" />
					               	</p:commandLink>
						        </p:column>
						        <p:column width="20%" headerText="#{msg['collections.items.size']}">
							        <h:outputText value="#{item.size}" />
						        </p:column>
						        <p:column width="20%" headerText="#{msg['collections.items.format']}">
							        <h:outputText value="#{item.format}" />
						        </p:column>
						        <p:column width="10%" headerText="#{msg['collections.items.delete']}">
							        <p:commandButton style="width:100%"
										styleClass="btn btn-default col-sm-1"
										value="#{msg['collections.button.remove']}"
										action="#{collectionController.removeItemFile(item)}"
										update="collectionsForm:panelItems"
										rendered="#{collectionController.addCollectionNew}">
										
									</p:commandButton>
						        </p:column>
						    </p:dataTable>
		    				
		    			</p:outputPanel>
	    				
	    			</p:fieldset>
					
				</p:outputPanel>
				
			</p:outputPanel>
			
			<p:outputPanel id="panelBotones" styleClass="form-horizontal">
				
				<p:outputPanel rendered="#{collectionController.showFormulario}">
					
					<p:commandButton id="cancelButton"
						styleClass="btn btn-default col-sm-2"
						value="#{msg['collections.button.cancel']}"
						action="#{collectionController.cancel}"
						update="panelSelectAction, collectionsForm:panelFormulario, panelBotones">
					</p:commandButton>
					
					<p:commandButton id="editButton"
						styleClass="btn btn-default col-sm-2"
						value="#{msg['collections.button.save']}"
						action="#{collectionController.editCollection}"
						rendered="#{!collectionController.addCollectionNew}"
						update="panelSelectAction, collectionsForm:panelFormulario, panelBotones">
					</p:commandButton>
					
					<p:commandButton id="saveButton"
						styleClass="btn btn-default col-sm-2"
						value="#{msg['collections.button.save']}"
						action="#{collectionController.addCollection}"
						rendered="#{collectionController.addCollectionNew}"
						update="panelSelectAction, collectionsForm:panelFormulario, panelBotones">
					</p:commandButton>
					
				</p:outputPanel>
				
			</p:outputPanel>

		<div class="clearfix" />
		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
			<div class="dialog-footer">
				<p:commandButton value="#{msg['general.button.accept']}"
					type="button"
					styleClass="btn btn-danger f-right ui-confirmdialog-yes" />
				<p:commandButton value="#{msg['general.button.cancel']}"
					type="button"
					styleClass="btn btn-default f-right ui-confirmdialog-no" />
			</div>
		</p:confirmDialog>
				
		</div>		
		</h:form>
		
	</ui:define>
</ui:composition>